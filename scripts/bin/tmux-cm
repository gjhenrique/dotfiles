#!/bin/bash

COMMAND="$1"

# Get current tmux session mode
CURRENT_SESSION=$(tmux display-message -p '#S')
#CURRENT_WINDOW=$(tmux display-message -p '#I')

TARGET_WINDOW=200

# By convention, the index 9 is the last created. This MAY be the wrong approach
TMUX_OPEN=$(tmux list-windows | cut -f 1 -d ' ' | sed 's/://' | grep $TARGET_WINDOW | wc -l)

if [[ $TMUX_OPEN == 0 ]]; then

    tmux new-window -d -t $CURRENT_SESSION:$TARGET_WINDOW -n cm -c ~/Projects/CM

    tmux send-keys -t $CURRENT_SESSION:$TARGET_WINDOW bash C-m
    tmux send-keys -t $CURRENT_SESSION:$TARGET_WINDOW "source build/envsetup.sh" C-m
fi

if [[ -n $COMMAND ]]; then
    tmux send-keys -t $CURRENT_SESSION:$TARGET_WINDOW "$COMMAND" C-m
fi

